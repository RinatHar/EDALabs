<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Online Shoppers Prediction</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .header {
            text-align: center;
            margin-bottom: 30px;
        }
        .card {
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
            background: #f9f9f9;
        }
        .button {
            background: #4CAF50;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        .button:hover {
            background: #45a049;
        }
        .result {
            padding: 15px;
            margin: 10px 0;
            border-radius: 5px;
        }
        .success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .data-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }
        .data-table th, .data-table td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
        }
        .data-table th {
            background-color: #f2f2f2;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Online Shoppers Purchasing Intention</h1>
            <p>Predict customer purchase behavior based on session data</p>
        </div>

        <div class="card">
            <h2>Data Information</h2>
            <button class="button" onclick="loadData()">Load Dataset Info</button>
            <button class="button" onclick="generateEDA()">Generate EDA Report</button>
            <div id="dataInfo"></div>
        </div>

        <div class="card">
            <h2>Model Training</h2>
            <button class="button" onclick="trainModel()">Train Model</button>
            <div id="trainingResult"></div>
        </div>

        <div class="card">
            <h2>Make Prediction</h2>
            <div id="predictionForm">
                <p>Enter session data for prediction:</p>
                <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px;">
                    <input type="number" id="admin" placeholder="Administrative" step="1">
                    <input type="number" id="admin_dur" placeholder="Admin Duration" step="0.1">
                    <input type="number" id="info" placeholder="Informational" step="1">
                    <input type="number" id="info_dur" placeholder="Info Duration" step="0.1">
                    <input type="number" id="product" placeholder="Product Related" step="1">
                    <input type="number" id="product_dur" placeholder="Product Duration" step="0.1">
                    <input type="number" id="bounce" placeholder="Bounce Rate" step="0.001">
                    <input type="number" id="exit" placeholder="Exit Rate" step="0.001">
                    <input type="number" id="pageval" placeholder="Page Value" step="0.1">
                    <input type="number" id="special" placeholder="Special Day" step="0.1" min="0" max="1">
                    <select id="month">
                        <option value="Jan">January</option>
                        <option value="Feb">February</option>
                        <option value="Mar">March</option>
                        <option value="Apr">April</option>
                        <option value="May">May</option>
                        <option value="Jun">June</option>
                        <option value="Jul">July</option>
                        <option value="Aug">August</option>
                        <option value="Sep">September</option>
                        <option value="Oct">October</option>
                        <option value="Nov">November</option>
                        <option value="Dec">December</option>
                    </select>
                    <input type="number" id="os" placeholder="Operating System" step="1" min="1" max="8">
                    <input type="number" id="browser" placeholder="Browser" step="1" min="1" max="13">
                    <input type="number" id="region" placeholder="Region" step="1" min="1" max="9">
                    <input type="number" id="traffic" placeholder="Traffic Type" step="1" min="1" max="20">
                    <select id="visitor">
                        <option value="New_Visitor">New Visitor</option>
                        <option value="Returning_Visitor" selected>Returning Visitor</option>
                        <option value="Other">Other</option>
                    </select>
                    <select id="weekend">
                        <option value="false">Weekday</option>
                        <option value="true">Weekend</option>
                    </select>
                </div>
                <button class="button" onclick="makePrediction()" style="margin-top: 20px;">Predict Purchase</button>
                <div id="predictionResult"></div>
            </div>
        </div>

        <div class="card">
            <h2>System Status</h2>
            <button class="button" onclick="checkHealth()">Check Health</button>
            <div id="healthStatus"></div>
        </div>
    </div>

    <script>
        const API_BASE = window.location.origin.includes('8080') ? 
            window.location.origin.replace('8080', '5000') : 
            'http://localhost:5000';

        async function loadData() {
            try {
                const response = await fetch(`${API_BASE}/api/data`);
                const data = await response.json();
                
                if (data.status === 'success') {
                    let html = `<p><strong>Shape:</strong> ${data.shape[0]} rows Ã— ${data.shape[1]} columns</p>`;
                    html += `<p><strong>Columns:</strong> ${data.columns.join(', ')}</p>`;
                    
                    if (data.data && data.data.length > 0) {
                        html += `<h3>Sample Data (first 10 rows):</h3>`;
                        html += `<table class="data-table">`;
                        html += `<tr><th>${Object.keys(data.data[0]).join('</th><th>')}</th></tr>`;
                        data.data.slice(0, 10).forEach(row => {
                            html += `<tr><td>${Object.values(row).join('</td><td>')}</td></tr>`;
                        });
                        html += `</table>`;
                    }
                    
                    document.getElementById('dataInfo').innerHTML = `<div class="result success">${html}</div>`;
                } else {
                    document.getElementById('dataInfo').innerHTML = 
                        `<div class="result error">Error: ${data.message}</div>`;
                }
            } catch (error) {
                document.getElementById('dataInfo').innerHTML = 
                    `<div class="result error">Error: ${error.message}</div>`;
            }
        }

        async function generateEDA() {
            try {
                const response = await fetch(`${API_BASE}/api/eda`);
                if (response.ok) {
                    const blob = await response.blob();
                    const url = window.URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = 'online_shoppers_eda.html';
                    document.body.appendChild(a);
                    a.click();
                    a.remove();
                    
                    document.getElementById('dataInfo').innerHTML = 
                        `<div class="result success">EDA report generated and downloaded successfully!</div>`;
                }
            } catch (error) {
                document.getElementById('dataInfo').innerHTML = 
                    `<div class="result error">Error: ${error.message}</div>`;
            }
        }

        async function trainModel() {
            try {
                const response = await fetch(`${API_BASE}/api/train`, {
                    method: 'POST'
                });
                const data = await response.json();
                
                if (data.status === 'success') {
                    document.getElementById('trainingResult').innerHTML = 
                        `<div class="result success">${data.message}</div>`;
                } else {
                    document.getElementById('trainingResult').innerHTML = 
                        `<div class="result error">Error: ${data.message}</div>`;
                }
            } catch (error) {
                document.getElementById('trainingResult').innerHTML = 
                    `<div class="result error">Error: ${error.message}</div>`;
            }
        }

        async function makePrediction() {
            const inputData = {
                Administrative: parseInt(document.getElementById('admin').value) || 0,
                Administrative_Duration: parseFloat(document.getElementById('admin_dur').value) || 0,
                Informational: parseInt(document.getElementById('info').value) || 0,
                Informational_Duration: parseFloat(document.getElementById('info_dur').value) || 0,
                ProductRelated: parseInt(document.getElementById('product').value) || 0,
                ProductRelated_Duration: parseFloat(document.getElementById('product_dur').value) || 0,
                BounceRates: parseFloat(document.getElementById('bounce').value) || 0,
                ExitRates: parseFloat(document.getElementById('exit').value) || 0,
                PageValues: parseFloat(document.getElementById('pageval').value) || 0,
                SpecialDay: parseFloat(document.getElementById('special').value) || 0,
                Month: document.getElementById('month').value,
                OperatingSystems: parseInt(document.getElementById('os').value) || 1,
                Browser: parseInt(document.getElementById('browser').value) || 1,
                Region: parseInt(document.getElementById('region').value) || 1,
                TrafficType: parseInt(document.getElementById('traffic').value) || 1,
                VisitorType: document.getElementById('visitor').value,
                Weekend: document.getElementById('weekend').value === 'true'
            };

            try {
                const response = await fetch(`${API_BASE}/api/predict`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(inputData)
                });
                
                const data = await response.json();
                
                if (data.status === 'success') {
                    const resultDiv = document.getElementById('predictionResult');
                    resultDiv.innerHTML = `
                        <div class="result success">
                            <h3>Prediction Result</h3>
                            <p><strong>Input Data:</strong></p>
                            <pre>${JSON.stringify(inputData, null, 2)}</pre>
                            <p><strong>Prediction:</strong> ${data.prediction} (${data.result})</p>
                            <p><strong>Interpretation:</strong> ${data.result === 'Purchase' ? 
                                'Customer is likely to make a purchase' : 
                                'Customer is not likely to make a purchase'}</p>
                        </div>
                    `;
                } else {
                    document.getElementById('predictionResult').innerHTML = 
                        `<div class="result error">Error: ${data.message}</div>`;
                }
            } catch (error) {
                document.getElementById('predictionResult').innerHTML = 
                    `<div class="result error">Error: ${error.message}</div>`;
            }
        }

        async function checkHealth() {
            try {
                const response = await fetch(`${API_BASE}/health`);
                const data = await response.json();
                
                document.getElementById('healthStatus').innerHTML = 
                    `<div class="result success">
                        <p><strong>Status:</strong> ${data.status}</p>
                        <p><strong>Service:</strong> ${data.service}</p>
                        <p><strong>Timestamp:</strong> ${new Date().toLocaleString()}</p>
                    </div>`;
            } catch (error) {
                document.getElementById('healthStatus').innerHTML = 
                    `<div class="result error">Error: ${error.message}</div>`;
            }
        }
    </script>
</body>
</html>